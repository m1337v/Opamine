THEOS ?= ~/theos
TARGET := iphone:clang:latest:15.0
ARCHS = arm64

THEOS_PLATFORM_DEB_COMPRESSION_TYPE = gzip

include $(THEOS)/makefiles/common.mk

LIBRARY_NAME = palera1n

palera1n_FILES = palera1n.m
palera1n_CFLAGS = -fobjc-arc -I../../../../BaseBin/.include
palera1n_LDFLAGS = -L../../../../BaseBin/.build -ljailbreak
palera1n_INSTALL_PATH = /usr/lib

include $(THEOS_MAKE_PATH)/library.mk

SUBPROJECTS += exploit_server
include $(THEOS_MAKE_PATH)/aggregate.mk

before-package::
	mkdir -p ./.framework
	install_name_tool -change "@loader_path/libjailbreak.dylib" "@executable_path/libjailbreak.dylib" $(THEOS_STAGING_DIR)/usr/lib/palera1n.dylib
	cp $(THEOS_STAGING_DIR)/usr/lib/palera1n.dylib ./.framework/palera1n
	cp $(THEOS_STAGING_DIR)/usr/bin/exploit_server ./.framework/
	cp ./Info.plist ./.framework/

clean::
	rm -rf ./.theos
	rm -rf ./packages
	rm -rf ./.framework
